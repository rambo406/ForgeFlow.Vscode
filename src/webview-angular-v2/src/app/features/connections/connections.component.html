<section class="mb-6">
    <div class="flex items-center justify-between mb-2">
        <div>
            <h1 class="text-2xl font-bold mb-1 text-white">Connections & Settings</h1>
            <p class="text-gray-400">Configure and test Azure DevOps and Copilot access.</p>
        </div>
        <a routerLink="/" class="px-3 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Back to Dashboard</a>
    </div>

    <!-- Alerts -->
    <div *ngIf="error()" class="mb-3 text-red-400">{{ error() }}</div>
    <div *ngIf="success()" class="mb-3 text-green-400">{{ success() }}</div>

    <!-- Azure DevOps Configuration -->
    <div class="p-4 rounded-md border border-gray-600 mb-4">
        <p class="font-medium mb-3">Azure DevOps Configuration</p>
        <form [formGroup]="configForm" class="grid gap-3" (ngSubmit)="saveConfig()">
            <label class="grid gap-1">
                <span class="text-sm text-gray-300">Organization URL</span>
                <input formControlName="organizationUrl" type="text" class="w-full px-2 py-1 bg-transparent border border-gray-600 rounded" placeholder="https://dev.azure.com/your-org">
            </label>
            <label class="grid gap-1">
                <span class="text-sm text-gray-300">Personal Access Token</span>
                <input formControlName="personalAccessToken" type="password" class="w-full px-2 py-1 bg-transparent border border-gray-600 rounded" placeholder="Enter PAT (stored securely)">
            </label>
            <label class="grid gap-1">
                <span class="text-sm text-gray-300">Default Project</span>
                <input formControlName="defaultProject" type="text" class="w-full px-2 py-1 bg-transparent border border-gray-600 rounded" placeholder="Project name">
            </label>
            <div class="flex gap-2 mt-2 flex-wrap">
                <button type="button" (click)="testOrganization()" class="px-3 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Test Org URL</button>
                <button type="button" (click)="testPat()" class="px-3 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Test PAT</button>
                <button type="button" (click)="testProject()" class="px-3 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Test Project</button>
                <button type="submit" hlmBtn variant="default">Save</button>
            </div>
        </form>
    </div>

    <!-- GitHub Copilot / Language Model Test -->
    <div class="p-4 rounded-md border border-gray-600">
        <p class="font-medium mb-3">Language Model (Copilot) Test</p>
        <form [formGroup]="modelForm" class="flex items-end gap-2 flex-wrap" (ngSubmit)="testModel()">
            <label class="grid gap-1 flex-1 min-w-60">
                <span class="text-sm text-gray-300">Model Name</span>
                <input formControlName="modelName" type="text" class="w-full px-2 py-1 bg-transparent border border-gray-600 rounded" placeholder="e.g., gpt-4o, copilot-gpt-4" />
            </label>
            <button type="submit" hlmBtn>Test Model</button>
            <button type="button" (click)="loadModels()" class="px-3 py-2 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Load Available Models</button>
        </form>

        <div class="mt-3" *ngIf="availableModels().length > 0">
            <div class="text-sm text-gray-400 mb-2">Available Models</div>
            <div class="grid gap-2">
                <div *ngFor="let m of availableModels()" class="flex items-center justify-between p-2 rounded border border-gray-600">
                    <div>
                        <div class="text-white text-sm">{{ m.name }} <span class="text-gray-400">({{ m.id }})</span></div>
                        <div class="text-xs text-gray-400">{{ m.vendor }} • {{ m.family }} <span *ngIf="m.version">• v{{ m.version }}</span></div>
                    </div>
                    <button (click)="pickModel(m.id)" class="px-2 py-1 rounded border border-gray-600 text-gray-300 hover:bg-gray-700">Use</button>
                </div>
            </div>
        </div>
    </div>
</section>
