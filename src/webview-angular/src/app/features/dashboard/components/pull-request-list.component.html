<div class="h-full flex flex-col">
    <!-- Search and Filters - Enhanced Mobile-First Responsive -->
    <div class="border-b border-vscode-panel-border bg-vscode-panel-background/95 p-vscode-lg sticky-subheader">
        <div class="container-vscode flex flex-col space-y-vscode-lg vscode-lg:flex-row vscode-lg:space-y-0 vscode-lg:items-center vscode-lg:gap-vscode-lg">
            <!-- Search Input - Full Width on Mobile -->
            <div class="w-full vscode-sm:min-w-[300px] vscode-lg:flex-1">
                <input
                        (input)="onSearchChange($any($event.target).value)"
                        [value]="searchTerm() || ''"
                        class="input-vscode w-full text-vscode-sm"
                        placeholder="Search pull requests..."
                        type="text"
                />
            </div>

            <!-- Filter Controls - Stacked on Mobile, Inline on Desktop -->
            <div class="flex flex-col space-y-vscode-sm vscode-sm:flex-row vscode-sm:space-y-0 vscode-sm:space-x-vscode-md vscode-sm:flex-wrap">
                <select
                        (change)="onFilterChange('author', $any($event.target).value)"
                        [value]="filters().author || ''"
                        class="input-vscode text-vscode-sm w-full vscode-sm:w-auto vscode-sm:min-w-[140px]"
                >
                    @for (option of authorOptions(); track option.value) {
                        <option [value]="option.value">{{ option.label }}</option>
                    }
                </select>

                <select
                        (change)="onFilterChange('repository', $any($event.target).value)"
                        [value]="filters().repository || ''"
                        class="input-vscode text-vscode-sm w-full vscode-sm:w-auto vscode-sm:min-w-[140px]"
                >
                    @for (option of repositoryOptions(); track option.value) {
                        <option [value]="option.value">{{ option.label }}</option>
                    }
                </select>

                <select
                        (change)="onFilterChange('status', $any($event.target).value)"
                        [value]="filters().status || ''"
                        class="input-vscode text-vscode-sm w-full vscode-sm:w-auto vscode-sm:min-w-[120px]"
                >
                    @for (option of statusOptions(); track option.value) {
                        <option [value]="option.value">{{ option.label }}</option>
                    }
                </select>

                <!-- Date Range - Mobile-Optimized -->
                <div class="flex flex-col space-y-vscode-sm vscode-sm:flex-row vscode-sm:space-y-0 vscode-sm:items-center vscode-sm:space-x-vscode-sm">
                    <input
                            (change)="onDateRangeChange('from', $any($event.target).value)"
                            [value]="filters().dateRange?.from || ''"
                            class="input-vscode text-vscode-sm w-full vscode-sm:w-auto"
                            placeholder="From date"
                            type="date"
                    />
                    <span class="text-vscode-muted text-vscode-sm hidden vscode-sm:inline">to</span>
                    <input
                            (change)="onDateRangeChange('to', $any($event.target).value)"
                            [value]="filters().dateRange?.to || ''"
                            class="input-vscode text-vscode-sm w-full vscode-sm:w-auto"
                            placeholder="To date"
                            type="date"
                    />
                </div>

                <!-- Clear Filters Button - Touch-Friendly -->
                <app-button
                        (onClick)="onClearFilters()"
                        additionalClasses="w-full vscode-sm:w-auto"
                        size="sm"
                        variant="outline"
                >
                    Clear Filters
                </app-button>
            </div>
        </div>
    </div>

    <!-- Pull Request Table -->
    <div class="flex-1 overflow-auto">
        @if (isLoading()) {
            <div class="flex items-center justify-center h-full container-vscode">
                <div class="text-muted-foreground">Loading pull requests...</div>
            </div>
        } @else if (pullRequests().length === 0) {
            <div class="flex flex-col items-center justify-center h-full text-center container-vscode">
                <div class="text-muted-foreground mb-2">No pull requests found</div>
                <div class="text-sm text-muted-foreground">
                    @if (searchTerm() || filters().author || filters().status) {
                        Try adjusting your search criteria
                    } @else {
                        No pull requests available in this project
                    }
                </div>
            </div>
        } @else if (enableVirtualScroll() && pullRequests().length > 20) {
            <!-- Virtual Scroll Implementation for Large Lists -->
            <app-virtual-scroll
                    [items]="pullRequests()"
                    [itemTemplate]="prItemTemplate"
                    [containerHeight]="virtualScrollHeight()"
                    [config]="{
          itemHeight: 120,
          bufferSize: 5,
          threshold: 0.8,
          enableDynamicHeight: false
        }"
                    (scrollToEnd)="scrollToEnd.emit()"
            ></app-virtual-scroll>
        } @else {
            <!-- Regular Table Implementation for Smaller Lists -->
            <app-table [columns]="tableColumns" additionalClasses="h-full">
                @for (pr of pullRequests(); track pr.id) {
                    <app-table-row
                            additionalClasses="cursor-pointer hover:bg-muted/50 transition-colors"
                            (click)="onSelectPR(pr.id)"
                    >
                        <app-table-cell>
                            <div class="flex flex-col">
                                <div class="font-medium text-sm line-clamp-2">{{ pr.title }}</div>
                                <div class="text-xs text-muted-foreground mt-1">
                                    #{{ pr.id }} • {{ pr.repository }}
                                </div>
                            </div>
                        </app-table-cell>

                        <app-table-cell>
                            <div class="flex items-center gap-2">
                                <div class="text-sm">{{ pr.author }}</div>
                                @if (pr.authorImageUrl) {
                                    <img
                                            [src]="pr.authorImageUrl"
                                            [alt]="pr.author"
                                            class="w-6 h-6 rounded-full"
                                    />
                                }
                            </div>
                        </app-table-cell>

                        <app-table-cell>
                            <app-badge
                                    [variant]="getStatusVariant(pr.status)"
                            >
                                {{ getStatusLabel(pr.status) }}
                            </app-badge>
                            @if (pr.isDraft) {
                                <app-badge variant="secondary" additionalClasses="ml-2">
                                    Draft
                                </app-badge>
                            }
                        </app-table-cell>

                        <app-table-cell additionalClasses="hidden vscode-sm:table-cell">
                            <div class="text-sm">
                                {{ formatDate(pr.createdDate) }}
                            </div>
                            @if (pr.ageInDays) {
                                <div class="text-xs text-muted-foreground">
                                    {{ pr.ageInDays }} days ago
                                </div>
                            }
                        </app-table-cell>

                        <app-table-cell additionalClasses="hidden vscode-md:table-cell">
                            <div class="text-xs">
                                <div>{{ pr.sourceRefName }} →</div>
                                <div>{{ pr.targetRefName }}</div>
                            </div>
                        </app-table-cell>

                        <app-table-cell>
                            <div class="flex gap-2">
                                <app-button
                                        size="sm"
                                        variant="outline"
                                        (onClick)="onSelectPR(pr.id); $event.stopPropagation()"
                                >
                                    View
                                </app-button>
                                <app-button
                                        size="sm"
                                        (onClick)="onAnalyzePR(pr.id); $event.stopPropagation()"
                                >
                                    Analyze
                                </app-button>
                            </div>
                        </app-table-cell>
                    </app-table-row>
                }
            </app-table>
        }
    </div>
</div>

<!-- Template for Virtual Scroll Items - Enhanced Mobile-First -->
<ng-template #prItemTemplate let-index="index" let-pr>
    <div (click)="onSelectPR(pr.id)"
         class="pr-virtual-item p-vscode-lg border-b border-vscode-panel-border bg-vscode-panel-background hover:bg-vscode-list-hover transition-colors cursor-pointer">
        <div class="flex items-start justify-between gap-vscode-lg">
            <!-- Main PR Info - Mobile-Optimized Layout -->
            <div class="flex-1 min-w-0">
                <div class="flex items-start gap-vscode-sm mb-vscode-sm flex-col vscode-sm:flex-row vscode-sm:items-center">
                    <h3 class="font-medium text-vscode-sm line-clamp-2 flex-1">{{ pr.title }}</h3>
                    <div class="flex gap-vscode-xs">
                        <app-badge [variant]="getStatusVariant(pr.status)">
                            {{ getStatusLabel(pr.status) }}
                        </app-badge>
                        @if (pr.isDraft) {
                            <app-badge variant="secondary">Draft</app-badge>
                        }
                    </div>
                </div>

                <div class="text-vscode-xs text-vscode-muted mb-vscode-sm">
                    #{{ pr.id }} • {{ pr.repository }}
                </div>

                <!-- Author and Date - Responsive Layout -->
                <div class="flex flex-col space-y-vscode-xs vscode-sm:flex-row vscode-sm:space-y-0 vscode-sm:items-center vscode-sm:gap-vscode-lg text-vscode-sm">
                    <div class="flex items-center gap-vscode-xs">
                        @if (pr.authorImageUrl) {
                            <img
                                    [src]="pr.authorImageUrl"
                                    [alt]="pr.author"
                                    class="w-5 h-5 rounded-full"
                            />
                        }
                        <span>{{ pr.author }}</span>
                    </div>

                    <div class="text-vscode-muted">
                        {{ formatDate(pr.createdDate) }}
                        @if (pr.ageInDays) {
                            <span class="text-vscode-xs">({{ pr.ageInDays }} days ago)</span>
                        }
                    </div>
                </div>

                <div class="text-vscode-xs text-vscode-muted mt-vscode-xs">
                    <span class="font-mono">{{ pr.sourceRefName }}</span> → <span
                        class="font-mono">{{ pr.targetRefName }}</span>
                </div>
            </div>

            <!-- Actions - Mobile-First Button Layout -->
            <div class="flex flex-col gap-vscode-xs vscode-sm:flex-row vscode-sm:gap-vscode-sm flex-shrink-0">
                <app-button
                        (onClick)="onSelectPR(pr.id); $event.stopPropagation()"
                        additionalClasses="w-full vscode-sm:w-auto text-vscode-xs"
                        size="sm"
                        variant="outline"
                >
                    <span class="vscode-sm:hidden">View</span>
                    <span class="hidden vscode-sm:inline">View Details</span>
                </app-button>
                <app-button
                        (onClick)="onAnalyzePR(pr.id); $event.stopPropagation()"
                        additionalClasses="w-full vscode-sm:w-auto text-vscode-xs"
                        size="sm"
                >
                    Analyze
                </app-button>
            </div>
        </div>
    </div>
</ng-template>
